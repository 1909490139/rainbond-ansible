---
- name: Rainbond | Copy DB Script
  template:
    src: updatedb.sh.j2
    dest: /tmp/updatedb.sh
    mode: 0777

- name: Rainbond | Copy Image Push Script
  template:
    src: pushimage.sh.j2
    dest: /tmp/pushimage.sh
    mode: 0777

- name: Rainbond | Copy init db script
  template:
    src: init.sql.j2
    dest: /tmp/init.sql

- name: Rainbond | Run update DB
  shell: "bash /tmp/updatedb.sh > /tmp/init.log"
  register: updatedb_task_result
  until: updatedb_task_result is succeeded
  retries: 5

#- name: show updatedb_task_result debug info
#  debug: var=updatedb_task_result

- name: Rainbond | Push local images to goodrain.me
  shell: "bash /tmp/pushimage.sh"
  register: pushimage_task_result
  until: pushimage_task_result is succeeded
  retries: 5